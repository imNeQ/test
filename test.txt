(() => {
  const KEY = "test_login_count";
  const MAX = 5;

  const n = +(localStorage.getItem(KEY) || 0);
  if (n >= MAX) {
    console.log(`Limit ${MAX} prób osiągnięty.`);
    return;
  }

  const userEl   = document.querySelector('input[name="username"]');
  const passEl   = document.querySelector('input[name="password"]');
  const submitEl = document.querySelector('input[name="submit"][type="submit"]');

  if (!userEl || !passEl || !submitEl) {
    console.error("Nie znaleziono pól formularza.");
    return;
  }

  // wpisz dane i wywołaj zdarzenia
  userEl.value = "xx";
  passEl.value = "xx";
  ["input","change"].forEach(evt => {
    userEl.dispatchEvent(new Event(evt, { bubbles: true }));
    passEl.dispatchEvent(new Event(evt, { bubbles: true }));
  });

  const next = n + 1;
  localStorage.setItem(KEY, String(next));
  console.log(`Próba ${next} z ${MAX} — wysyłam formularz...`);

  // wyślij
  submitEl.click();
})();
